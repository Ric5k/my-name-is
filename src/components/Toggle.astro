---

---

<button
  id="theme-toggle"
  type="button"
  class="theme-toggle"
  aria-label="Toggle dark mode"
>
  <span class="icon-sun" aria-hidden="true">
    <!-- Sun icon -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      width="20"
      height="20"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <circle cx="12" cy="12" r="4"></circle>
      <path
        d="M12 2v2M12 20v2M4.9 4.9l1.4 1.4M17.7 17.7l1.4 1.4M2 12h2M20 12h2M4.9 19.1l1.4-1.4M17.7 6.3l1.4-1.4"
      ></path>
    </svg>
  </span>

  <span class="icon-moon" aria-hidden="true">
    <!-- Moon icon -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      width="20"
      height="20"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
    </svg>
  </span>
</button>

<script>
  const initToggle = () => {
    const button = document.getElementById("theme-toggle");
    if (!button) return;

    button.onclick = (e) => {
      const x = e.clientX;
      const y = e.clientY;

      document.documentElement.style.setProperty("--toggle-x", `${x}px`);
      document.documentElement.style.setProperty("--toggle-y", `${y}px`);

      const root = document.documentElement;
      const isDark = root.classList.contains("dark");

      // View Transition（対応ブラウザ）
      if (document.startViewTransition) {
        document.startViewTransition(() => {
          root.classList.toggle("dark", !isDark);
          localStorage.setItem("theme", !isDark ? "dark" : "light");
        });
      } else {
        // 非対応ブラウザ（Firefoxなど）
        root.classList.toggle("dark", !isDark);
        localStorage.setItem("theme", !isDark ? "dark" : "light");
      }
    };
  };

  initToggle();
  document.addEventListener("astro:after-swap", initToggle);
</script>

<style>
  /* ===== Button UI ===== */

  .theme-toggle {
    position: relative;
    width: 40px;
    height: 40px;
    cursor: pointer;
    border: none;
    background: none;
    padding: 0;
    color: var(--text-color);
    display: flex;
    align-items: center;
    justify-content: center;
    outline: none;
  }

  .theme-toggle:hover {
    opacity: 0.85;
  }

  .theme-toggle svg {
    display: block;
  }

  .icon-sun,
  .icon-moon {
    position: absolute;
  }

  .icon-sun,
  :global(.dark) .icon-moon {
    display: none;
  }

  :global(.dark) .icon-sun,
  .icon-moon {
    display: block;
  }

  /* ===== View Transition ===== */

  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation: none;
    mix-blend-mode: normal;
  }
  ::view-transition-new(root) {
    animation: reveal 1200ms ease-out;
    clip-path: circle(0 at var(--toggle-x) var(--toggle-y));
  }
  @keyframes reveal {
    0% {
      clip-path: circle(0 at var(--toggle-x) var(--toggle-y));
    }
    60% {
      clip-path: circle(340vmax at var(--toggle-x) var(--toggle-y));
    }
    100% {
      clip-path: circle(150vmax at var(--toggle-x) var(--toggle-y));
    }
  }
</style>
